version: "3.4"
services:
  pumba-network-delay:
    image: integritee-fork-producer:dev
    build:
      context: .
      dockerfile: fork.Dockerfile
    depends_on: [ 'integritee-node', 'integritee-worker-1', 'integritee-worker-2' ]
    networks:
      - integritee-test-network
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    entrypoint: "dockerize -wait http://integritee-worker-2:4646/is_initialized -timeout 250s
     pumba --interval 30s netem --interface eth0 --target integritee-worker-2 --duration 10s delay --time 900 integritee-worker-2"
networks:
  integritee-test-network:
    driver: bridge