services:
  worker-ping:
    image: worker-ping:dev
    build:
      context: .
      dockerfile: ping.Dockerfile
    depends_on: [ 'integritee-node-${NETWORK:-default}', 'integritee-worker-1-${NETWORK:-default}', 'integritee-worker-2-${NETWORK:-default}' ]
    networks:
      - integritee-test-network-${NETWORK:-default}
    #entrypoint: "ping integritee-worker-2 | while read pong; do echo \"$$(date): $$pong\"; done"
    entrypoint: "ping integritee-worker-2-${NETWORK:-default}"
  pumba-network-delay:
    image: integritee-fork-producer:dev
    build:
      context: .
      dockerfile: fork.Dockerfile
    depends_on:
      integritee-node-${NETWORK:-default}:
        condition: service_healthy
      integritee-worker-1-${NETWORK:-default}:
        condition: service_healthy
      integritee-worker-2-${NETWORK:-default}:
        condition: service_healthy
    networks:
      - integritee-test-network-${NETWORK:-default}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    entrypoint:
      "pumba --interval 3m netem --interface eth0 --duration 30s delay --time 1000 integritee-worker-2-${NETWORK:-default}"